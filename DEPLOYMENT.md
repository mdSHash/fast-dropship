# Deployment Guide - Fast-Dropship

Complete guide for deploying Fast-Dropship to production.

## Table of Contents
1. [Pre-Deployment Checklist](#pre-deployment-checklist)
2. [Backend Deployment](#backend-deployment)
3. [Frontend Deployment](#frontend-deployment)
4. [Post-Deployment](#post-deployment)
5. [Monitoring & Maintenance](#monitoring--maintenance)

---

## Pre-Deployment Checklist

### Code Preparation
- [ ] All features tested locally
- [ ] Environment variables configured
- [ ] Database migrations ready
- [ ] Security keys generated
- [ ] CORS settings updated
- [ ] API documentation reviewed
- [ ] Error handling implemented
- [ ] Logging configured

### Repository Setup
- [ ] Code pushed to GitHub/GitLab
- [ ] `.gitignore` properly configured
- [ ] Secrets not committed
- [ ] README.md updated
- [ ] License file added

### Database
- [ ] Production database created
- [ ] Backup strategy planned
- [ ] Connection string secured
- [ ] Migration scripts tested

---

## Backend Deployment

### Option 1: Railway (Recommended)

**Why Railway?**
- Free tier available
- Easy PostgreSQL setup
- Automatic deployments
- Built-in monitoring

**Steps:**

1. **Create Railway Account**
   - Visit https://railway.app
   - Sign up with GitHub

2. **Create New Project**
   ```
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Choose your repository
   - Select backend directory
   ```

3. **Add PostgreSQL Database**
   ```
   - Click "New" â†’ "Database" â†’ "PostgreSQL"
   - Railway will create and connect automatically
   - Copy DATABASE_URL from variables
   ```

4. **Configure Environment Variables**
   ```bash
   # In Railway dashboard, add these variables:
   DATABASE_URL=<auto-generated-by-railway>
   SECRET_KEY=<generate-new-secure-key>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   ALLOWED_ORIGINS=https://your-frontend-domain.vercel.app
   ```

5. **Configure Build Settings**
   ```
   Root Directory: backend
   Build Command: pip install -r requirements.txt
   Start Command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
   ```

6. **Deploy**
   - Railway will auto-deploy on push
   - Check logs for any errors
   - Note your backend URL

### Option 2: Render

**Steps:**

1. **Create Render Account**
   - Visit https://render.com
   - Sign up with GitHub

2. **Create Web Service**
   ```
   - New â†’ Web Service
   - Connect repository
   - Configure:
     - Name: fast-dropship-api
     - Environment: Python 3
     - Build Command: pip install -r requirements.txt
     - Start Command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
   ```

3. **Add PostgreSQL Database**
   ```
   - New â†’ PostgreSQL
   - Connect to web service
   - Copy Internal Database URL
   ```

4. **Set Environment Variables**
   ```bash
   DATABASE_URL=<from-render-postgres>
   SECRET_KEY=<generate-secure-key>
   ALGORITHM=HS256
   ACCESS_TOKEN_EXPIRE_MINUTES=30
   ALLOWED_ORIGINS=https://your-frontend.vercel.app
   ```

5. **Deploy**
   - Render will build and deploy
   - Monitor build logs
   - Test API endpoints

### Option 3: Heroku

**Steps:**

1. **Install Heroku CLI**
   ```bash
   # macOS
   brew tap heroku/brew && brew install heroku
   
   # Windows
   # Download from https://devcenter.heroku.com/articles/heroku-cli
   ```

2. **Login and Create App**
   ```bash
   heroku login
   heroku create fast-dropship-api
   ```

3. **Add PostgreSQL**
   ```bash
   heroku addons:create heroku-postgresql:mini
   ```

4. **Set Environment Variables**
   ```bash
   heroku config:set SECRET_KEY=$(python3 -c "import secrets; print(secrets.token_urlsafe(32))")
   heroku config:set ALGORITHM=HS256
   heroku config:set ACCESS_TOKEN_EXPIRE_MINUTES=30
   heroku config:set ALLOWED_ORIGINS=https://your-frontend.vercel.app
   ```

5. **Create Procfile**
   ```bash
   echo "web: uvicorn app.main:app --host 0.0.0.0 --port \$PORT" > backend/Procfile
   ```

6. **Deploy**
   ```bash
   git subtree push --prefix backend heroku main
   ```

---

## Frontend Deployment

### Vercel (Recommended)

**Why Vercel?**
- Built for Next.js
- Free tier generous
- Automatic deployments
- Global CDN
- Zero configuration

**Steps:**

1. **Create Vercel Account**
   - Visit https://vercel.com
   - Sign up with GitHub

2. **Import Project**
   ```
   - Click "Add New" â†’ "Project"
   - Import your repository
   - Select frontend directory
   ```

3. **Configure Build Settings**
   ```
   Framework Preset: Next.js
   Root Directory: frontend
   Build Command: npm run build
   Output Directory: .next
   Install Command: npm install
   ```

4. **Set Environment Variables**
   ```bash
   NEXT_PUBLIC_API_URL=https://your-backend-url.railway.app
   ```

5. **Deploy**
   - Click "Deploy"
   - Wait for build to complete
   - Visit your site URL

6. **Configure Custom Domain (Optional)**
   ```
   - Go to Project Settings â†’ Domains
   - Add your custom domain
   - Update DNS records as instructed
   ```

### Netlify (Alternative)

**Steps:**

1. **Create Netlify Account**
   - Visit https://netlify.com
   - Sign up with GitHub

2. **Import Project**
   ```
   - New site from Git
   - Choose repository
   - Configure:
     - Base directory: frontend
     - Build command: npm run build
     - Publish directory: .next
   ```

3. **Set Environment Variables**
   ```bash
   NEXT_PUBLIC_API_URL=https://your-backend-url.railway.app
   ```

4. **Deploy**
   - Netlify will build and deploy
   - Check deploy logs
   - Visit site URL

---

## Post-Deployment

### 1. Update Backend CORS

Update `ALLOWED_ORIGINS` in backend to include your frontend URL:

```bash
# Railway/Render Dashboard
ALLOWED_ORIGINS=https://your-app.vercel.app,https://www.your-app.vercel.app
```

### 2. Test All Features

**Authentication:**
- [ ] User registration works
- [ ] Login works
- [ ] Token refresh works
- [ ] Logout works
- [ ] Password change works

**CRUD Operations:**
- [ ] Create clients
- [ ] Read clients
- [ ] Update clients
- [ ] Delete clients
- [ ] Same for orders, deliveries, transactions

**Dashboard:**
- [ ] KPIs display correctly
- [ ] Charts render
- [ ] Recent data shows

**API Connectivity:**
- [ ] All API calls succeed
- [ ] Error handling works
- [ ] Loading states work

### 3. Seed Production Database (Optional)

```bash
# SSH into your backend server or use Railway CLI
railway run python seed_data.py

# Or via Render shell
# Or via Heroku run
heroku run python seed_data.py -a fast-dropship-api
```

### 4. Set Up Custom Domain

**Backend (Railway):**
```
- Settings â†’ Networking â†’ Custom Domain
- Add your API subdomain (api.yourdomain.com)
- Update DNS CNAME record
```

**Frontend (Vercel):**
```
- Settings â†’ Domains
- Add your domain (yourdomain.com)
- Update DNS records as shown
```

### 5. Enable HTTPS

Both Railway and Vercel automatically provide SSL certificates.

Verify:
- [ ] Backend uses HTTPS
- [ ] Frontend uses HTTPS
- [ ] Mixed content warnings resolved

---

## Monitoring & Maintenance

### Application Monitoring

**Railway:**
- Built-in metrics dashboard
- View logs in real-time
- Set up usage alerts

**Vercel:**
- Analytics dashboard
- Performance insights
- Error tracking

### Database Backups

**Railway PostgreSQL:**
```bash
# Automatic daily backups included
# Manual backup:
railway run pg_dump $DATABASE_URL > backup.sql
```

**Render PostgreSQL:**
```bash
# Automatic backups on paid plans
# Manual backup via dashboard
```

### Log Monitoring

**Backend Logs:**
```bash
# Railway
railway logs

# Render
# View in dashboard

# Heroku
heroku logs --tail -a fast-dropship-api
```

**Frontend Logs:**
```bash
# Vercel dashboard â†’ Logs
# Real-time function logs
# Build logs
```

### Performance Monitoring

**Tools to Consider:**
- Sentry (Error tracking)
- LogRocket (Session replay)
- Google Analytics (User analytics)
- Uptime Robot (Uptime monitoring)

### Regular Maintenance

**Weekly:**
- [ ] Check error logs
- [ ] Monitor performance
- [ ] Review user feedback

**Monthly:**
- [ ] Update dependencies
- [ ] Review security alerts
- [ ] Backup database
- [ ] Check disk usage

**Quarterly:**
- [ ] Rotate SECRET_KEY
- [ ] Security audit
- [ ] Performance optimization
- [ ] Feature review

---

## Troubleshooting

### Backend Issues

**Build Fails:**
```bash
# Check requirements.txt
# Verify Python version
# Check build logs
```

**Database Connection Fails:**
```bash
# Verify DATABASE_URL
# Check database is running
# Verify network access
```

**CORS Errors:**
```bash
# Update ALLOWED_ORIGINS
# Include all frontend URLs
# Restart backend service
```

### Frontend Issues

**Build Fails:**
```bash
# Check package.json
# Verify Node version
# Check build logs
# Clear cache and rebuild
```

**API Connection Fails:**
```bash
# Verify NEXT_PUBLIC_API_URL
# Check backend is running
# Verify CORS settings
# Check network tab in browser
```

**Environment Variables Not Working:**
```bash
# Ensure NEXT_PUBLIC_ prefix
# Redeploy after changes
# Clear browser cache
```

---

## Scaling Considerations

### When to Scale

**Backend:**
- Response time > 1 second
- CPU usage > 80%
- Memory usage > 80%
- Database connections maxed

**Frontend:**
- Page load time > 3 seconds
- High traffic periods
- Global user base

### Scaling Options

**Backend:**
- Upgrade Railway/Render plan
- Add more instances
- Implement caching (Redis)
- Optimize database queries
- Use CDN for static files

**Frontend:**
- Vercel auto-scales
- Implement ISR (Incremental Static Regeneration)
- Optimize images
- Code splitting
- Lazy loading

---

## Security Checklist

### Pre-Production
- [ ] All secrets in environment variables
- [ ] No hardcoded credentials
- [ ] HTTPS enforced
- [ ] CORS properly configured
- [ ] SQL injection prevention (using ORM)
- [ ] XSS prevention (React escapes by default)
- [ ] CSRF protection
- [ ] Rate limiting implemented
- [ ] Input validation on all endpoints
- [ ] Error messages don't leak info

### Post-Production
- [ ] Security headers configured
- [ ] Regular dependency updates
- [ ] Monitoring for suspicious activity
- [ ] Backup and recovery tested
- [ ] Incident response plan
- [ ] Regular security audits

---

## Cost Estimation

### Free Tier (Development/Small Projects)

**Backend (Railway):**
- $0/month (500 hours free)
- PostgreSQL included

**Frontend (Vercel):**
- $0/month
- 100GB bandwidth
- Unlimited deployments

**Total: $0/month**

### Paid Tier (Production)

**Backend (Railway):**
- ~$5-20/month
- Depends on usage

**Frontend (Vercel):**
- $20/month (Pro plan)
- More bandwidth
- Advanced features

**Database:**
- Included or ~$7-15/month

**Total: ~$25-55/month**

---

## Support Resources

- **Railway Docs**: https://docs.railway.app
- **Render Docs**: https://render.com/docs
- **Vercel Docs**: https://vercel.com/docs
- **FastAPI Docs**: https://fastapi.tiangolo.com
- **Next.js Docs**: https://nextjs.org/docs

---

## Quick Deploy Commands

```bash
# Backend (Railway)
railway login
railway init
railway up

# Frontend (Vercel)
npm i -g vercel
vercel login
vercel --prod

# Or use GitHub integration for automatic deployments
```

---

## Success Criteria

Your deployment is successful when:
- [ ] Backend API is accessible via HTTPS
- [ ] Frontend loads without errors
- [ ] Users can register and login
- [ ] All CRUD operations work
- [ ] Dashboard displays data
- [ ] No console errors
- [ ] Mobile responsive
- [ ] Performance is acceptable
- [ ] Monitoring is active
- [ ] Backups are configured

ðŸŽ‰ **Congratulations! Your application is now live!**